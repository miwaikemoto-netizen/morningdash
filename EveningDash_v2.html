<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Evening Dash â€” å…¥çœ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ v2</title>
<meta name="theme-color" content="#0f172a">
<style>
:root{
  --bg:#f7fafc; --fg:#0f172a; --muted:#64748b;
  --card:#ffffff; --border:#e5e7eb; --accent:#0ea5e9; --accent-press:#0284c7;
  --radius:16px; --shadow:0 6px 20px rgba(2,8,23,.06);
}
*{box-sizing:border-box}
body{margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial; background:linear-gradient(#fff,#f1f5f9); color:var(--fg)}
.container{max-width:900px; margin:0 auto; padding:16px 16px 72px}
h1{margin:0 0 8px; font-size:28px}
h2{margin:0 0 10px; font-size:20px}
.card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px; margin:10px 0}
.row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.btn{appearance:none; border:1px solid var(--border); border-radius:14px; padding:10px 14px; background:#fff; cursor:pointer}
.btn.primary{background:var(--accent); border-color:var(--accent); color:#fff}
.btn.primary:hover{background:var(--accent-press)}
.input, select, textarea{border:1px solid var(--border); border-radius:12px; padding:10px 12px; background:#fff; font-size:14px}
textarea{width:100%; min-height:92px; resize:vertical}
.small{font-size:12px; color:var(--muted)}
.checklist{display:grid; grid-template-columns:repeat(2,minmax(220px,1fr)); gap:8px 14px}
@media (max-width:560px){ .checklist{grid-template-columns:1fr} }
.badge{border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-size:12px; color:var(--muted)}
.header{display:flex; justify-content:space-between; align-items:flex-end; gap:10px; flex-wrap:wrap; margin-bottom:8px}
.bigdate{display:flex; align-items:baseline; gap:6px}
.bigdate .md{font-weight:800; font-size:40px}
.bigdate .sep{font-size:28px; transform:translateY(-2px)}
.bigdate .y{font-weight:700; font-size:16px; color:var(--muted)}
.wday{font-weight:700}
#goodnight{display:none; font-size:40px; text-align:center; margin-top:12px}
footer{font-size:12px; color:var(--muted); margin-top:16px}
hr{border:none; border-top:1px solid var(--border); margin:12px 0}
.historyItem{padding:10px; border:1px dashed var(--border); border-radius:12px; margin-top:8px}
label.checkbox{display:flex; align-items:center; gap:8px; cursor:pointer}
label.checkbox input{transform:scale(1.2)}
.section-note{margin-top:4px; color:var(--muted); font-size:12px}
#musicRow{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <div class="badge">Evening Dash</div>
        <div class="bigdate">
          <span class="md" id="mdM">08</span><span class="sep">/</span><span class="md" id="mdD">28</span>
          <span class="y" id="mdY">2025</span>
          <span class="wday" id="mdW">æœ¨æ›œæ—¥</span>
        </div>
      </div>
      <div class="row">
        <input id="datePicker" type="date" class="input">
        <button id="saveBtn" class="btn primary">ä¿å­˜</button>
        <a href="./MorningDash_v20.html" class="btn">â˜€ï¸ æœã®è¨˜éŒ²ã¸</a>
      </div>
    </div>

    <!-- â‘  ç”Ÿæ´»ç¿’æ…£ãƒã‚§ãƒƒã‚¯ -->
    <section class="card" id="secHabits">
      <h2>â‘  ç”Ÿæ´»ç¿’æ…£ãƒã‚§ãƒƒã‚¯</h2>
      <div class="checklist">
        <label class="checkbox"><input type="checkbox" id="h_bath">ãŠé¢¨å‘‚</label>
        <label class="checkbox"><input type="checkbox" id="h_teeth">æ­¯ç£¨ã</label>
        <label class="checkbox"><input type="checkbox" id="h_skin">ã‚¹ã‚­ãƒ³ã‚±ã‚¢</label>
        <label class="checkbox"><input type="checkbox" id="h_hair">ãƒ˜ã‚¢ã‚±ã‚¢</label>
        <label class="checkbox"><input type="checkbox" id="h_special">ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚±ã‚¢</label>
        <label class="checkbox"><input type="checkbox" id="h_tomorrow">æ˜æ—¥ã®æº–å‚™</label>
      </div>
    </section>

    <!-- â‘¡ æ—¥è¨˜ãƒ»è¨˜éŒ² -->
    <section class="card" id="secDiary">
      <h2>â‘¡ æ—¥è¨˜ãƒ»è¨˜éŒ²</h2>

      <div class="row">
        <label>æ„Ÿæƒ…è¨˜éŒ²ï¼š</label>
        <select id="mood" class="input">
          <option value="">â€”</option>
          <option>æœ€é«˜</option>
          <option>è‰¯ã„</option>
          <option>æ™®é€š</option>
          <option>ã„ã¾ã„ã¡</option>
          <option>ã—ã‚“ã©ã„</option>
        </select>

        <label>æ°—åœ§(hPa)ï¼š</label>
        <input id="pressure" class="input" type="number" step="1" inputmode="decimal" style="width:10ch">
        <label>ä½“èª¿ï¼š</label>
        <input id="cond" class="input" placeholder="ä¾‹ï¼šé¦–ã“ã‚Šå¼·ã‚ï¼PMSãªã©" style="min-width:200px">
      </div>

      <div class="section-note">â€» æ°—åœ§ã¯æœã®å®šç‚¹è¦³æ¸¬å€¤ã‚’æ›¸ã„ã¦ã‚‚OKã€‚æœªå…¥åŠ›ã§ã‚‚ä¿å­˜ã§ãã¾ã™ã€‚</div>

      <hr>

      <div>
        <label>ğŸ“Œ å‡ºæ¥ãŸã“ã¨ãƒ»è‰¯ã‹ã£ãŸã“ã¨ï¼ˆæœ€å¤§3è¡Œï¼‰</label>
        <textarea id="diaryGood" placeholder="ä¾‹ï¼šæœã«æ•£æ­©ã§ããŸï¼ã‚¬ãƒ¼ãƒ‡ãƒ‹ãƒ³ã‚°30åˆ†ï¼é¦–ã®å¼µã‚ŠãŒè»½ã‹ã£ãŸ ãªã©"></textarea>
      </div>
      <div>
        <label>ğŸ“Œ æ˜æ—¥ã‚„ã‚ŠãŸã„ã“ã¨ï¼ˆ1è¡Œï¼‰</label>
        <input id="diaryNext" class="input" placeholder="ä¾‹ï¼šæœã«æ´—æ¿¯ï¼10åˆ†ã‚¹ãƒˆãƒ¬ãƒƒãƒ" style="width:100%">
      </div>
      <div>
        <label>ğŸ““ è‡ªç”±ãƒ¡ãƒ¢</label>
        <textarea id="diaryFree" placeholder="ãªã‚“ã§ã‚‚ã©ã†ã"></textarea>
      </div>
    </section>

    <!-- â‘¢ å…¥çœ å„€å¼ -->
    <section class="card" id="secSleep">
      <h2>â‘¢ å…¥çœ å„€å¼</h2>

      <div>
        <ul style="margin:6px 0 10px 18px; line-height:1.4">
          <li>ãƒ•ã‚©ãƒ¼ãƒ ãƒ­ãƒ¼ãƒ©ãƒ¼ï¼ˆèƒ¸ã‚’é–‹ã„ã¦æ·±å‘¼å¸ 30ç§’ã€œ1åˆ†ï¼‰</li>
          <li>è€³ã¾ã‚ã—ï¼ˆä¸Šâ†’ä¸­å¤®â†’ä¸‹ï¼å‰å›ã—â†’å¾Œå›ã— å„3å›ï¼‰</li>
          <li>è‚©ã™ãã‚å‘¼å¸ï¼ˆ3å›ï¼š<b>å¸</b>=ã™ãã‚ã‚‹ ï¼ <b>å</b>=ã‚¹ãƒˆãƒ³ï¼‰</li>
        </ul>
      </div>

      <div id="musicRow">
        <button id="playMusicBtn" class="btn primary">ğŸµ éŸ³æ¥½ã‚’å†ç”Ÿ</button>
        <span class="small">â€» æŠ¼ã™ã¨ YouTube Music ã®ç¡çœ ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆãŒé–‹ãã¾ã™ã€‚</span>
      </div>

      <div id="goodnight">ğŸ˜ª ãŠã‚„ã™ã¿</div>
    </section>

    <!-- å±¥æ­´ -->
    <section class="card">
      <div class="row" style="justify-content:space-between">
        <h2>å±¥æ­´</h2>
        <button id="reloadBtn" class="btn">å†èª­è¾¼</button>
      </div>
      <div id="history"></div>
    </section>

    <footer>
      ä¿å­˜å…ˆã¯ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆlocalStorageï¼‰ã€‚åŒã˜URLãªã‚‰ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ã‚‚å±¥æ­´ã¯å¼•ãç¶™ãŒã‚Œã¾ã™ã€‚
    </footer>
  </div>

<script>
(function(){
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const z2 = n => String(n).padStart(2,"0");
  const tz = "Asia/Tokyo";
  const wdJP = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
  const toKey = d => d.toLocaleDateString("ja-JP",{timeZone:tz});
  const toInputDate = d => `${d.getFullYear()}-${z2(d.getMonth()+1)}-${z2(d.getDate())}`;
  const fromInputDate = s => { const [y,m,d]=s.split("-").map(Number); return new Date(y, m-1, d); };

  // Header date
  function renderHeaderDate(d){
    $("#mdM").textContent = z2(d.getMonth()+1);
    $("#mdD").textContent = z2(d.getDate());
    $("#mdY").textContent = String(d.getFullYear());
    $("#mdW").textContent = wdJP[d.getDay()] + "æ›œæ—¥";
  }

  const today = new Date();
  let currentKey = toKey(today);
  renderHeaderDate(today);
  $("#datePicker").value = toInputDate(today);
  $("#datePicker").addEventListener("change", ()=>{
    const d = fromInputDate($("#datePicker").value);
    currentKey = toKey(d);
    renderHeaderDate(d);
    loadToForm(loadLog(currentKey));
  });

  // State
  const state = {
    habits: { bath:false, teeth:false, skin:false, hair:false, special:false, tomorrow:false },
    mood: "", pressure: "", cond: "",
    diaryGood: "", diaryNext: "", diaryFree: ""
  };

  // Storage helpers
  const KEY = "evening_logs_v2";
  const loadAll = () => JSON.parse(localStorage.getItem(KEY)||"[]");
  const saveAll = arr => localStorage.setItem(KEY, JSON.stringify(arr));
  const loadLog = key => loadAll().find(x=>x.date===key) || null;
  const upsert = payload => {
    const rest = loadAll().filter(x=>x.date!==payload.date);
    saveAll([payload, ...rest].sort((a,b)=> (a.date<b.date?1:-1)));
  };

  // Sync helpers
  function syncFormFromState(){
    $("#h_bath").checked = state.habits.bath;
    $("#h_teeth").checked = state.habits.teeth;
    $("#h_skin").checked = state.habits.skin;
    $("#h_hair").checked = state.habits.hair;
    $("#h_special").checked = state.habits.special;
    $("#h_tomorrow").checked = state.habits.tomorrow;
    $("#mood").value = state.mood||"";
    $("#pressure").value = state.pressure||"";
    $("#cond").value = state.cond||"";
    $("#diaryGood").value = state.diaryGood||"";
    $("#diaryNext").value = state.diaryNext||"";
    $("#diaryFree").value = state.diaryFree||"";
  }
  function loadToForm(log){
    if(!log){
      state.habits = { bath:false, teeth:false, skin:false, hair:false, special:false, tomorrow:false };
      state.mood=""; state.pressure=""; state.cond="";
      state.diaryGood=""; state.diaryNext=""; state.diaryFree="";
    }else{
      Object.assign(state.habits, log.habits||{});
      state.mood = log.mood||""; state.pressure=log.pressure||""; state.cond=log.cond||"";
      state.diaryGood=log.diaryGood||""; state.diaryNext=log.diaryNext||""; state.diaryFree=log.diaryFree||"";
    }
    syncFormFromState(); renderHistory();
  }

  // Wire inputs
  const bindCheck = (id, key) => $(id).addEventListener("change", ()=>{ state.habits[key] = $(id).checked; autoSave(); });
  bindCheck("#h_bath","bath"); bindCheck("#h_teeth","teeth"); bindCheck("#h_skin","skin");
  bindCheck("#h_hair","hair"); bindCheck("#h_special","special"); bindCheck("#h_tomorrow","tomorrow");
  $("#mood").addEventListener("change", ()=>{ state.mood=$("#mood").value; autoSave(); });
  $("#pressure").addEventListener("input", ()=>{ state.pressure=$("#pressure").value; autoSave(); });
  $("#cond").addEventListener("input", ()=>{ state.cond=$("#cond").value; autoSave(); });
  $("#diaryGood").addEventListener("input", ()=>{ state.diaryGood=$("#diaryGood").value; autoSave(); });
  $("#diaryNext").addEventListener("input", ()=>{ state.diaryNext=$("#diaryNext").value; autoSave(); });
  $("#diaryFree").addEventListener("input", ()=>{ state.diaryFree=$("#diaryFree").value; autoSave(); });

  // Save & history
  function saveNow(){
    const payload = { date: currentKey, habits: state.habits, mood: state.mood, pressure: state.pressure, cond: state.cond,
      diaryGood: state.diaryGood, diaryNext: state.diaryNext, diaryFree: state.diaryFree, ts: Date.now() };
    upsert(payload); renderHistory();
  }
  let t=null; function autoSave(){ clearTimeout(t); t=setTimeout(saveNow, 250); }
  $("#saveBtn").addEventListener("click", ()=>{ saveNow(); alert("ä¿å­˜ã—ã¾ã—ãŸ"); });
  $("#reloadBtn").addEventListener("click", renderHistory);

  function renderHistory(){
    const root = $("#history"); const logs = loadAll(); root.innerHTML="";
    if(!logs.length){ root.innerHTML = '<div class="small">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>'; return; }
    logs.forEach(l=>{
      const box = document.createElement("div"); box.className="historyItem";
      const lines = [];
      lines.push(`<b>${l.date}</b>`);
      const h = l.habits||{};
      const htxt = Object.entries({ãŠé¢¨å‘‚:"bath",æ­¯ç£¨ã:"teeth",ã‚¹ã‚­ãƒ³ã‚±ã‚¢:"skin",ãƒ˜ã‚¢ã‚±ã‚¢:"hair",ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚±ã‚¢:"special",æ˜æ—¥ã®æº–å‚™:"tomorrow"})
        .filter(([k,v]) => h[v]).map(([k])=>k).join(" / ") || "â€”";
      lines.push(`ç¿’æ…£ï¼š${htxt}`);
      const press = l.pressure? `${l.pressure}hPa` : "â€”";
      lines.push(`æ„Ÿæƒ…ï¼š${l.mood||"â€”"}ã€€æ°—åœ§ï¼š${press}ã€€ä½“èª¿ï¼š${l.cond||"â€”"}`);
      if(l.diaryGood) lines.push(`<div class="small">è‰¯ã‹ã£ãŸã“ã¨ï¼š${l.diaryGood.replace(/
/g," / ")}</div>`);
      if(l.diaryNext) lines.push(`<div class="small">æ˜æ—¥ï¼š${l.diaryNext}</div>`);
      if(l.diaryFree) lines.push(`<div class="small">ãƒ¡ãƒ¢ï¼š${l.diaryFree}</div>`);
      box.innerHTML = lines.join("<br>");
      root.appendChild(box);
    });
  }

  // Goodnight button
  $("#playMusicBtn").addEventListener("click", ()=>{
    window.open("https://music.youtube.com/playlist?list=PLUwMnSYvjfDQ9B8qPyifyyfonuhTY3C6y&si=6ssi1DGhphTAT_k7","_blank");
    $("#goodnight").style.display="block";
  });

  // init
  const saved = loadLog(currentKey);
  loadToForm(saved);
})();</script>
</body>
</html>
