<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>MorningDash â€“ v12 dash</title>
<meta name="theme-color" content="#0f172a">
<style>
:root{
  --bg:#f6f7fb; --fg:#0f172a; --muted:#64748b; --card:#ffffff; --line:#e5e7eb;
  --accent:#0ea5e9; --accent-press:#0284c7; --radius:16px; --shadow:0 8px 28px rgba(2,8,23,.06);
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial}
.container{max-width:980px;margin:0 auto;padding:16px}

/* èƒŒæ™¯ï¼ˆå¤©æ°—ã§å·®ã—æ›¿ãˆï¼‰ */
.bg-sunny{background:linear-gradient(180deg,#e0f2fe,#f8fafc)}
.bg-cloudy{background:linear-gradient(180deg,#e5e7eb,#f8fafc)}
.bg-rainy{background:linear-gradient(180deg,#c7d2fe,#eef2ff)}
.bg-storm{background:linear-gradient(180deg,#cbd5e1,#f1f5f9)}
.bg-snow{background:linear-gradient(180deg,#e2e8f0,#ffffff)}

/* ãƒ¼ãƒ¼ãƒ¼ãƒ¼ ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæ–°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ ãƒ¼ãƒ¼ãƒ¼ãƒ¼ */
.header{display:flex;align-items:flex-end;justify-content:space-between;margin:6px 0 10px;gap:12px}
.app{font-size:28px;font-weight:800;letter-spacing:.2px;opacity:.9} /* ã‚¿ã‚¤ãƒˆãƒ«ã¯å°‘ã—è–„ã */
.whenLink{display:block;text-decoration:none;color:inherit}
.dateBlock{display:flex;flex-direction:column;align-items:flex-end;line-height:1}
.row1{display:flex;gap:8px;align-items:flex-end}
.year{font-size:16px;font-weight:700;opacity:.9}     /* é’ã®æ (Y)ï¼šè¥¿æš¦ */
.md{font-size:40px;font-weight:900;letter-spacing:.5px} /* èµ¤ã®æ ï¼šæœˆæ—¥ï¼ˆå¤§ï¼‰ */
.sep{font-size:32px;font-weight:800;opacity:.9}
.row2{display:flex;gap:10px;align-items:center;margin-top:2px}
.wday{font-size:14px;font-weight:700;color:#059669}     /* ç·‘ã®æ ï¼šæ›œæ—¥ï¼ˆæ—¥æœ¬èªï¼‰ */
.clock{font-size:13px;color:var(--muted)}                /* èµ¤ä¸¸ï¼šå°ã•ã„æ™‚è¨ˆ */
.mono{font-feature-settings:"tnum";font-variant-numeric:tabular-nums}

/* ã‚«ãƒ¼ãƒ‰ãƒ»è¡Œ */
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin:14px 0;overflow:hidden;-webkit-mask-image:-webkit-radial-gradient(white, black)}
.card h2{font-size:18px;margin:0 0 8px 0}
.row{display:flex;gap:12px;flex-wrap:wrap}

/* KPIã‚«ãƒ¼ãƒ‰ */
.kpi{flex:1 1 220px;min-width:220px}
.kpi .big{font-size:36px;font-weight:800;line-height:1.1}
.kpi .sub{color:var(--muted);margin-top:4px}

/* å¤©æ°— */
.weather{display:flex;align-items:center;gap:14px}
.wx-emoji{font-size:44px}
.wx-lines{line-height:1.4}

/* å…¥åŠ›ãƒ»ãƒãƒƒãƒ—ãƒ»ãƒœã‚¿ãƒ³ */
.input{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fff}
textarea.input{min-height:96px}
.chip{border:1px solid var(--line);background:#fff;color:var(--fg);border-radius:999px;padding:6px 10px;font-size:13px}
.chip.active{background:var(--accent);border-color:var(--accent);color:#fff}
.btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 14px;cursor:pointer}
.btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
.btn.small{font-size:12px;padding:6px 10px}

.footer{font-size:12px;color:var(--muted);margin:24px 0}
</style>
</head>
<body class="bg-sunny">
<div class="container">
  <div class="header">
    <div class="app">MorningDash â˜€ï¸</div>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼å³ï¼šå¹´ / æœˆæ—¥ï¼ˆå¤§ï¼‰ / æ›œæ—¥ãƒ»æ™‚è¨ˆã€‚ã‚¿ãƒƒãƒ—ã§ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸ -->
    <a id="whenLink" class="whenLink" href="./v12_calendar.html">
      <div class="dateBlock mono">
        <div class="row1">
          <span id="year" class="year">â€”</span>
          <span id="month" class="md">â€”</span><span class="sep">/</span><span id="day" class="md">â€”</span>
        </div>
        <div class="row2">
          <span id="weekday" class="wday">â€”</span>
          <span id="clock" class="clock">--:--</span>
        </div>
      </div>
    </a>
  </div>

  <!-- å¤©æ°— -->
  <section class="card">
    <h2>å¤©æ°—ï¼ˆç¾åœ¨åœ°ï¼‰</h2>
    <div id="wx" class="weather">
      <div class="wx-emoji" id="wxEmoji">â›…ï¸</div>
      <div class="wx-lines" id="wxLines">
        <div class="mono" id="wxTemp">â€”Â°C</div>
        <div class="muted" id="wxDesc">ä½ç½®æƒ…å ±ã®è¨±å¯å¾Œã«è¡¨ç¤º</div>
      </div>
    </div>
    <div style="margin-top:8px">
      <button id="btnWx" class="btn small">å†å–å¾—</button>
    </div>
  </section>

  <!-- ä»Šæ—¥ã®æ•°å€¤ï¼ˆKPIï¼‰ -->
  <section class="row">
    <div class="card kpi">
      <h2>ç¡çœ </h2>
      <div class="big mono" id="kpiSleep">â€”h â€”m</div>
      <div class="sub">è¡¨ç¤ºä¸­ã®æ—¥ä»˜</div>
    </div>
    <div class="card kpi">
      <h2>ä½“é‡</h2>
      <div class="big mono" id="kpiWeight">â€” kg</div>
      <div class="sub">è¡¨ç¤ºä¸­ã®æ—¥ä»˜</div>
    </div>
    <div class="card kpi">
      <h2>ä½“è„‚è‚ª</h2>
      <div class="big mono" id="kpiBodyFat">â€” %</div>
      <div class="sub">è¡¨ç¤ºä¸­ã®æ—¥ä»˜</div>
    </div>
    <div class="card kpi">
      <h2>æ°—åˆ†ãƒ»å…ƒæ°—</h2>
      <div class="big" id="kpiMood">â€”</div>
      <div class="sub" id="kpiEnergy">â€”</div>
    </div>
  </section>

  <!-- ãƒ¡ãƒ¢ -->
  <section class="card">
    <h2>è‡ªç”±ãƒ¡ãƒ¢</h2>
    <textarea id="note" class="input" placeholder="ä»Šæ—¥ã®ãƒ¡ãƒ¢â€¦"></textarea>
    <div style="margin-top:8px"><button id="btnSave" class="btn primary">ã“ã®æ—¥ã®è¨˜éŒ²ã‚’ä¿å­˜</button></div>
  </section>

  <!-- å±¥æ­´ï¼ˆæŠœç²‹ï¼‰ -->
  <section class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2>å±¥æ­´ï¼ˆæœ€è¿‘ï¼‰</h2>
      <button id="btnReload" class="btn small">å†èª­è¾¼</button>
    </div>
    <div id="history"></div>
  </section>

  <div class="footer">
    Tips: å…±æœ‰ â†’ ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ  ã§ã‚¢ãƒ—ãƒªé¢¨ã«ä½¿ãˆã¾ã™ã€‚ä¿å­˜å…ˆã¯ã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆlocalStorageï¼‰ã€‚
  </div>
</div>

<script>
(function(){
  // ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ======
  const $ = s => document.querySelector(s);
  const pad = n => String(n).padStart(2,"0");
  const wdays = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
  const toKey = d => d.toLocaleDateString("ja-JP",{timeZone:"Asia/Tokyo"}); // 2025/8/16
  const toISO = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  const fromISO = s => { const [y,m,da]=(s||"").split("-").map(Number); return (y&&m&&da)? new Date(y,m-1,da): null; };

  const LOGS_KEY = "md_logs_v2";
  const loadAll = () => JSON.parse(localStorage.getItem(LOGS_KEY) || "[]");
  const load = (k) => loadAll().find(x => x.date === k) || null;
  const upsert = (p) => { const arr = loadAll().filter(x => x.date !== p.date); localStorage.setItem(LOGS_KEY, JSON.stringify([p, ...arr])); };

  // ====== å¯¾è±¡æ—¥ï¼ˆ?date=YYYY-MM-DD ãŒã‚ã‚Œã°ãã‚Œï¼‰ ======
  const url = new URL(location.href);
  const qpDate = url.searchParams.get("date");
  const today = new Date();
  let currentDate = fromISO(qpDate) || today;
  let currentKey = toKey(currentDate);

  // ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šå¹´ãƒ»æœˆæ—¥ãƒ»æ›œæ—¥ãƒ»æ™‚è¨ˆ
  function renderHeaderWhen(){
    $("#year").textContent = currentDate.getFullYear();
    $("#month").textContent = pad(currentDate.getMonth()+1);
    $("#day").textContent   = pad(currentDate.getDate());
    $("#weekday").textContent = wdays[currentDate.getDay()];
    $("#whenLink").href = `./v12_calendar.html?date=${toISO(currentDate)}`; // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å—ã‘æ¸¡ã—
  }
  function tickClock(){
    const now = new Date();
    $("#clock").textContent = `${pad(now.getHours())}:${pad(now.getMinutes())}`;
  }
  renderHeaderWhen(); tickClock(); setInterval(tickClock, 1000);

  // ====== KPIè¡¨ç¤º ======
  function showKPI(){
    const log = load(currentKey);
    const sleepMin = log ? (log.sleepMin || 0) : 0;
    const h = Math.floor(sleepMin/60), m = sleepMin%60;
    $("#kpiSleep").textContent = sleepMin ? `${h}h ${m}m` : "â€”h â€”m";
    $("#kpiWeight").textContent = (log && log.weight!=null) ? `${log.weight} kg` : "â€” kg";
    $("#kpiBodyFat").textContent = (log && log.bodyFat!=null) ? `${log.bodyFat} %` : "â€” %";
    $("#kpiMood").textContent = (log && log.mood) || "â€”";
    $("#kpiEnergy").textContent = (log && log.energy) || "â€”";
    $("#note").value = (log && log.note) || "";
  }

  // ====== å±¥æ­´ï¼ˆæœ€è¿‘5ä»¶ï¼‰ ======
  function renderHistory(){
    const root = $("#history"); root.innerHTML = "";
    const logs = loadAll();
    if (!logs.length){ root.innerHTML = '<div class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>'; return; }
    logs.slice(0,5).forEach(l=>{
      const div=document.createElement("div"); div.className="card"; div.style.margin="10px 0";
      const sm = l.sleepMin||0;
      div.innerHTML = `
        <div class="muted">${l.date}</div>
        <div style="margin-top:6px">
          æ°—åˆ†ï¼š${l.mood||"â€”"}ã€€å…ƒæ°—ï¼š${l.energy||"â€”"}ã€€ç¡çœ ï¼š${Math.floor(sm/60)}æ™‚é–“${sm%60}åˆ†
          ${l.weight!=null?`ã€€ä½“é‡ï¼š${l.weight}kg`:""} ${l.bodyFat!=null?`ã€€ä½“è„‚è‚ªï¼š${l.bodyFat}%`:""}
        </div>
        ${l.note?`<div style="margin-top:4px">${l.note}</div>`:""}
      `;
      root.appendChild(div);
    });
  }

  // ====== å¤©æ°—ï¼ˆçµµæ–‡å­—ï¼†èƒŒæ™¯ï¼‰ ======
  function codeToEmoji(code){
    if ([0,1].includes(code)) return {e:"â˜€ï¸",bg:"bg-sunny",desc:"å¿«æ™´/æ™´ã‚Œ"};
    if ([2,3,45,48].includes(code)) return {e:"â›…ï¸",bg:"bg-cloudy",desc:"æ›‡ã‚Š/éœ§"};
    if ([51,53,55,61,63,65].includes(code)) return {e:"ğŸŒ§ï¸",bg:"bg-rainy",desc:"é›¨"};
    if ([95,96,99].includes(code)) return {e:"â›ˆï¸",bg:"bg-storm",desc:"é›·é›¨"};
    if ([71,73,75,85,86].includes(code)) return {e:"ğŸŒ¨ï¸",bg:"bg-snow",desc:"é›ª"};
    return {e:"â›…ï¸",bg:"bg-cloudy",desc:"â€”"};
  }
  function setBg(bg){ document.body.className = bg; }
  function renderWeather(w){
    const m = codeToEmoji(w.code||3);
    $("#wxEmoji").textContent = m.e;
    $("#wxTemp").textContent = `${Math.round(w.temp)}Â°C`;
    $("#wxDesc").textContent = `${m.desc}ã€€é¢¨:${Math.round(w.wind)}m/s`;
    setBg(m.bg);
  }
  function fetchWeather(){
    $("#wxDesc").textContent="å–å¾—ä¸­â€¦";
    if (!("geolocation" in navigator)){ $("#wxDesc").textContent="ä½ç½®æƒ…å ±éå¯¾å¿œ"; return; }
    navigator.geolocation.getCurrentPosition(pos=>{
      const {latitude, longitude} = pos.coords;
      const u = new URL("https://api.open-meteo.com/v1/forecast");
      u.searchParams.set("latitude", latitude);
      u.searchParams.set("longitude", longitude);
      u.searchParams.set("current_weather","true");
      u.searchParams.set("timezone","Asia/Tokyo");
      fetch(u.toString()).then(r=>r.json()).then(d=>{
        const c = d.current_weather||{};
        renderWeather({temp:c.temperature, wind:c.windspeed, code:c.weathercode});
      }).catch(()=>{$("#wxDesc").textContent="å–å¾—å¤±æ•—";});
    }, ()=>{$("#wxDesc").textContent="ä½ç½®æƒ…å ±æœªè¨±å¯";},{timeout:8000});
  }
  $("#btnWx").addEventListener("click", fetchWeather);
  fetchWeather();

  // ====== ä¿å­˜ & å†èª­è¾¼ ======
  $("#btnSave").addEventListener("click", ()=>{
    const existing = load(currentKey) || {date:currentKey, mood:"", energy:"", symptoms:[], sleepMin:0, weight:null, bodyFat:null, note:"", weather:null, quickTasks:[{done:false,text:""},{done:false,text:""},{done:false,text:""}]};
    existing.note = $("#note").value||"";
    existing.ts = Date.now();
    upsert(existing);
    renderHistory();
    alert("ä¿å­˜ã—ã¾ã—ãŸ");
  });
  $("#btnReload").addEventListener("click", ()=>{ showKPI(); renderHistory(); });

  // åˆæœŸè¡¨ç¤º
  showKPI();
  renderHistory();
})();
</script>
</body>
</html>
