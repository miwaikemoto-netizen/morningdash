<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>MorningDash – Calendar</title>
<meta name="theme-color" content="#0f172a">
<style>
:root{
  --bg:#f6f7fb; --fg:#0f172a; --muted:#64748b; --card:#ffffff; --line:#e5e7eb;
  --radius:16px; --shadow:0 8px 28px rgba(2,8,23,.06);
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial}
.wrap{max-width:980px;margin:0 auto;padding:16px;height:100%;display:flex;flex-direction:column}
.head{display:flex;align-items:center;justify-content:space-between;margin:6px 0 12px}
.title{font-size:22px;font-weight:800}
.nav{display:flex;gap:8px}
.btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:12px;padding:8px 12px;cursor:pointer}
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:12px;overflow:hidden}

.grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;flex:1}
.cell{background:#fff;border:1px solid var(--line);border-radius:12px;padding:8px;min-height:90px;display:flex;flex-direction:column;justify-content:flex-start}
.dow{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-bottom:6px}
.dow div{font-size:12px;text-align:center;color:var(--muted)}
.daynum{font-weight:700}
.dot{width:8px;height:8px;border-radius:999px;background:#cbd5e1;margin-top:4px}
.today{outline:2px solid #0f172a;outline-offset:2px}

.legend{display:flex;gap:10px;align-items:center;margin-top:10px;color:var(--muted);font-size:12px}
.legend span{display:inline-flex;align-items:center;gap:6px}
.legend .chip{width:10px;height:10px;border-radius:999px;display:inline-block}
.c1{background:#be123c}.c2{background:#f43f5e}.c3{background:#fecaca}.c0{background:#cbd5e1}
.footer{font-size:12px;color:var(--muted);margin-top:12px}
.link{color:#0ea5e9;text-decoration:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="head">
    <div class="title" id="label">—</div>
    <div class="nav">
      <button id="prev" class="btn">←</button>
      <button id="next" class="btn">→</button>
      <a href="./index.html" class="btn">Dashへ</a>
    </div>
  </div>

  <div class="card">
    <div class="dow"><div>日</div><div>月</div><div>火</div><div>水</div><div>木</div><div>金</div><div>土</div></div>
    <div id="grid" class="grid"></div>
    <div class="legend">
      <span><i class="chip c1"></i>❤️‍🔥</span>
      <span><i class="chip c2"></i>❤️まずまず</span>
      <span><i class="chip c3"></i>❤️‍🩹</span>
      <span><i class="chip c0"></i>記録なし</span>
    </div>
  </div>

  <div class="footer">
    日付をタップすると <a id="jumpBase" class="link" href="./index.html">ダッシュボード</a> に移動し、その日付が表示されます。
  </div>
</div>

<script>
(function(){
  const $ = s => document.querySelector(s);
  const pad = n => String(n).padStart(2,"0");
  const toKey = d => d.toLocaleDateString("ja-JP",{timeZone:"Asia/Tokyo"}); // 2025/8/16
  const toISO = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  const LOGS_KEY = "md_logs_v2";
  const loadAll = () => JSON.parse(localStorage.getItem(LOGS_KEY) || "[]");

  // 表示開始月（?date=YYYY-MM-DD があればその月）
  const url = new URL(location.href);
  const qpDate = url.searchParams.get("date");
  const base = qpDate ? new Date(qpDate) : new Date();
  let ym = new Date(base.getFullYear(), base.getMonth(), 1);

  function label(){ $("#label").textContent = `${ym.getFullYear()}年 ${ym.getMonth()+1}月`; }

  function colorByEnergy(e){
    if (!e) return "#cbd5e1";
    if (e.includes("❤️‍🔥")) return "#be123c";
    if (e.includes("❤️まず")) return "#f43f5e";
    if (e.includes("❤️‍🩹")) return "#fecaca";
    return "#cbd5e1";
  }

  function render(){
    label();
    const grid = $("#grid"); grid.innerHTML = "";
    const logs = loadAll(); const byDate = new Map(logs.map(l=>[l.date,l]));
    const firstDow = new Date(ym.getFullYear(), ym.getMonth(), 1).getDay();
    const days = new Date(ym.getFullYear(), ym.getMonth()+1, 0).getDate();
    for(let i=0;i<firstDow;i++){ const pad=document.createElement("div"); grid.appendChild(pad); }
    for(let d=1; d<=days; d++){
      const cell=document.createElement("div"); cell.className="cell";
      const dt = new Date(ym.getFullYear(), ym.getMonth(), d);
      const key = toKey(dt);
      const iso = toISO(dt);

      const head=document.createElement("div");
      const n=document.createElement("div"); n.className="daynum"; n.textContent = d;
      const dot=document.createElement("div"); dot.className="dot";
      const rec = byDate.get(key);
      dot.style.background = colorByEnergy(rec?.energy||"");
      head.appendChild(n); head.appendChild(dot);
      cell.appendChild(head);

      if (toKey(new Date())===key) cell.classList.add("today");

      cell.style.cursor="pointer";
      cell.onclick = ()=>{ location.href = `./v12_dash.html?date=${iso}`; };

      grid.appendChild(cell);
    }
  }

  $("#prev").onclick = ()=>{ ym = new Date(ym.getFullYear(), ym.getMonth()-1, 1); render(); };
  $("#next").onclick = ()=>{ ym = new Date(ym.getFullYear(), ym.getMonth()+1, 1); render(); };

  render();
})();
</script>
</body>
</html>
