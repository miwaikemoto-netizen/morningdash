<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Morning Dash</title>
<meta name="theme-color" content="#d6f0ff" id="themeColor">
<style>
/* ===== このファイルが index.html（= 朝ページ本体） ===== */
/* 余計な親背景が存在しない前提。背景はこの body のみで決まる */
:root{
  --md-bg:#88c8ff;   /* 初期：明るい空色（晴れ） */
  --md-bg2:#d6f0ff;
  --fg:#0e1726;      /* 明るい背景に合わせた濃い文字色 */
  --muted:#354357;
  --card:#ffffffd9;  /* 半透明の白カード */
  --border:#0000001a;
  --accent:#2563eb; --accent-press:#1d4ed8;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;height:100%;color:var(--fg);transition:background .35s ease}
/* 背景は body のみ。擬似要素は使わない */
body{background:linear-gradient(180deg,var(--md-bg),var(--md-bg2));font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial}
.container{max-width:900px;margin:0 auto;padding:16px 16px 92px}
h1{margin:4px 0 4px;font-size:28px;line-height:1.2;font-weight:800;display:flex;gap:10px;align-items:baseline;flex-wrap:wrap}
h2{margin:0 0 10px;font-size:18px}
.card{background:var(--card);backdrop-filter:saturate(1.1) blur(2px);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 30px #00000030;padding:16px;margin:12px 0}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.row.nw{flex-wrap:nowrap}
.btn{appearance:none;border:1px solid var(--border);border-radius:14px;padding:8px 12px;background:#ffffffb3;cursor:pointer;color:#0e1726;text-decoration:none;font-size:14px}
.btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
.btn.primary:active{background:var(--accent-press)}
.btn.small{padding:6px 10px;font-size:13px}
.input,select,textarea{border:1px solid var(--border);border-radius:12px;padding:10px 12px;background:#ffffffcc;color:#0e1726;font-size:16px}
select[multiple]{min-height:132px}
textarea{width:100%;min-height:96px;resize:vertical}
.small{font-size:13px;color:#475569}
.labelBig{font-size:15px;font-weight:700;margin-right:6px}
.header{display:flex;justify-content:space-between;align-items:flex-end;gap:10px;flex-wrap:wrap;margin-bottom:6px}
.bigdate{display:flex;align-items:baseline;gap:8px}
.bigdate .date{font-weight:800;font-size:30px}
.bigdate .wday{font-weight:700}
#year{font-size:16px;font-weight:400;color:#64748b}
.historyItem{padding:10px;border:1px dashed var(--border);border-radius:12px;margin-top:8px;background:#fff}
label.checkbox{display:flex;align-items:center;gap:10px;cursor:pointer;font-size:16px}
label.checkbox input{transform:scale(1.2)}
.weatherTitle{display:flex;justify-content:space-between;align-items:center;gap:8px}
#wxMain{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.wxIcon{font-size:30px;line-height:1}
#wxTemp{font-size:22px;font-weight:800}
.wxLine{font-size:15px;font-weight:700;margin-top:6px}
#navRow{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.input.compact{width:120px}
.input.compact.short{width:86px}
@media (max-width:420px){ .input.compact{width:110px} .input.compact.short{width:78px} }
</style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>☀️ Morning Dash <span id="year">2025</span></h1>
        <div class="bigdate">
          <span class="date" id="ymd">--/--</span>
          <span class="wday" id="wday">---</span>
        </div>
      </div>
      <div id="navRow">
        <a href="./EveningDash.html" class="btn">🌙 夜の記録へ</a>
        <a id="openCal" href="./Calendar.html" class="btn">📅 カレンダー</a>
      </div>
    </div>

    <!-- ① 天気 -->
    <section class="card" id="secWeather">
      <div class="weatherTitle">
        <h2>① 天気（自動取得）</h2>
        <button id="useGeo" class="btn small">再取得</button>
      </div>
      <div id="wxMain">
        <div id="wxIcon" class="wxIcon">⏳</div>
        <div id="wxTemp">--°C</div>
      </div>
      <div id="wxLine1" class="wxLine">状況：—　降水確率：—</div>
      <div id="wxLine2" class="wxLine">湿度：—　気圧：—</div>
    </section>

    <!-- ② 日記・記録 -->
    <section class="card" id="secDiary">
      <h2>② 日記・記録</h2>
      <div class="row" style="align-items:center">
        <label for="moodSel" class="labelBig">感情</label>
        <select id="moodSel" class="input" aria-label="感情を選択">
          <option value="">（未選択）</option>
          <option>最高</option><option>良い</option><option>普通</option><option>いまいち</option><option>しんどい</option>
        </select>
      </div>
      <div class="row" style="align-items:flex-start">
        <label for="condSel" class="labelBig">体調（複数可）</label>
        <select id="condSel" class="input" multiple aria-label="体調を選択（複数可）">
          <option>首・肩こり</option><option>頭痛</option><option>腹痛/お腹の張り</option><option>腰の張り/腰痛</option>
          <option>自律神経の乱れ</option><option>胃腸弱め</option><option>むくみ</option><option>目の疲れ/ドライアイ</option>
          <option>睡眠の質低下</option><option>冷え</option><option>喉の痛み</option><option>鼻水/鼻づまり</option>
          <option>肌荒れ/かゆみ</option><option>花粉/アレルギー</option><option>だるさ/倦怠感</option><option>イライラ/不安</option>
          <option>モチベ低下</option><option>PMS</option><option>生理</option>
        </select>
      </div>

      <div class="row nw">
        <label class="labelBig" for="sleepH">睡眠</label>
        <input id="sleepH" class="input compact short" type="number" min="0" placeholder="7" aria-label="睡眠 時間">
        <span>時間</span>
        <input id="sleepM" class="input compact short" type="number" min="0" max="59" placeholder="30" aria-label="睡眠 分">
        <span>分</span>
      </div>

      <div class="row">
        <label class="labelBig" for="weight">体重</label>
        <input id="weight" class="input compact" type="number" step="0.1" placeholder="52.4" aria-label="体重">
        <span>kg</span>
      </div>
      <div class="row">
        <label class="labelBig" for="bodyFat">体脂肪</label>
        <input id="bodyFat" class="input compact" type="number" step="0.1" placeholder="21.8" aria-label="体脂肪">
        <span>%</span>
      </div>

      <div style="margin-top:12px">
        <label for="freeMemo">📓 自由メモ</label>
        <textarea id="freeMemo" placeholder="なんでもどうぞ"></textarea>
      </div>
    </section>

    <!-- ③ 生活習慣チェック -->
    <section class="card" id="secHabits">
      <h2>③ 生活習慣チェック</h2>
      <div class="row">
        <label class="checkbox"><input type="checkbox" id="h_curtain" aria-label="カーテンを開ける"> カーテンを開ける</label>
        <label class="checkbox"><input type="checkbox" id="h_bed" aria-label="布団を直す"> 布団を直す</label>
        <label class="checkbox"><input type="checkbox" id="h_change" aria-label="着替えをする"> 着替えをする</label>
        <label class="checkbox"><input type="checkbox" id="h_teeth" aria-label="歯磨き"> 歯磨き</label>
        <label class="checkbox"><input type="checkbox" id="h_skin" aria-label="スキンケア"> スキンケア</label>
        <label class="checkbox"><input type="checkbox" id="h_hair" aria-label="ヘアケア"> ヘアケア</label>
      </div>
    </section>

    <section class="card" id="secSave">
      <div class="row"><button id="saveBtn" class="btn primary">💾 保存</button></div>
      <div class="small">保存先：localStorage（morning_logs_index_single）。</div>
    </section>

    <section class="card">
      <div class="row" style="justify-content:space-between">
        <h2>履歴</h2>
        <button id="reloadBtn" class="btn">再読込</button>
      </div>
      <div id="history"></div>
    </section>
  </div>

<script>
(function(){
  function z2(n){ n=Number(n)||0; return (n<10?"0":"")+n; }
  function $(s){ return document.querySelector(s); }

  document.addEventListener("DOMContentLoaded", function(){
    // 日付・リンク
    var d=new Date();
    $("#year").textContent = d.getFullYear();
    $("#ymd").textContent  = z2(d.getMonth()+1)+"/"+z2(d.getDate());
    $("#wday").textContent = ["日","月","火","水","木","金","土"][d.getDay()]+"曜日";
    $("#openCal").href = "./Calendar.html?date=" + d.toISOString().slice(0,10);

    // 保存/履歴
    var KEY="morning_logs_index_single";
    function loadAll(){ try{ var v=localStorage.getItem(KEY); return v?JSON.parse(v):[]; }catch(e){ return []; } }
    function saveAll(arr){ try{ localStorage.setItem(KEY, JSON.stringify(arr)); }catch(e){} }
    function toKey(dt){ return dt.toLocaleDateString("ja-JP",{timeZone:"Asia/Tokyo"}); }
    function upsert(payload){
      var list=loadAll(), i=list.findIndex(x=>x.date===payload.date);
      if(i>-1) list[i]=payload; else list.unshift(payload);
      list.sort((a,b)=>a.date<b.date?1:-1);
      saveAll(list);
    }
    function renderHistory(){
      var root=$("#history"); root.innerHTML="";
      var logs=loadAll();
      if(!logs.length){ root.innerHTML='<div class="small">まだ記録がありません</div>'; return; }
      logs.forEach(l=>{
        var press = l.wx && l.wx.pressure!=null ? Math.round(l.wx.pressure)+"hPa" : "—";
        var hum   = l.wx && l.wx.humidity!=null ? Math.round(l.wx.humidity)+"%" : "—";
        var pprob = l.wx && l.wx.pprob!=null ? Math.round(l.wx.pprob)+"%" : "—";
        var wtemp = l.wx && l.wx.temp!=null ? Math.round(l.wx.temp)+"°C" : "—";
        var trend = (l.wx&&l.wx.trend)||"—";
        var box=document.createElement("div"); box.className="historyItem";
        box.innerHTML="<b>"+l.date+"</b>　天気："+wtemp+"・降水確率："+pprob+"・湿度："+hum+"・気圧："+press+" ["+trend+"]";
        root.appendChild(box);
      });
    }
    $("#reloadBtn").addEventListener("click", renderHistory);
    $("#saveBtn").addEventListener("click", function(){
      upsert({date:toKey(new Date()), wx:state.wx, ts:Date.now()}); renderHistory(); alert("保存しました");
    });

    // 天気取得 + 明るい配色
    var state={wx:null};
    var TOKYO={lat:35.681236, lon:139.767125};

    function nearestIndex(times, targetISO){
      var best=-1, bestDiff=1e18, t0=new Date(targetISO).getTime();
      for(var i=0;i<times.length;i++){ var dt=new Date(times[i]).getTime(); var d=Math.abs(dt-t0); if(d<bestDiff){best=i;bestDiff=d;} }
      return best;
    }
    function pressureTrend(arr, idx){
      if(!(arr&&arr.length) || idx<1) return "安定";
      var diff = arr[idx] - arr[idx-1];
      if(diff>1.5) return "上昇"; if(diff<-1.5) return "下降"; return "安定";
    }
    function themeFromCode(code){
      if(code===0 || code===1) return ["#88c8ff","#d6f0ff"];           // 快晴・晴れ（空色）
      if(code===2)                   return ["#a6c1de","#eaf1fb"];     // 薄曇り
      if(code===3 || code===45 || code===48) return ["#8ea1b5","#d4dbe3"]; // 曇り・霧
      if((code>=51 && code<=55) || (code>=61 && code<=67)) return ["#5f7f92","#b8d2db"]; // 霧雨・雨
      if(code>=71 && code<=86)      return ["#bfe2ff","#eef7ff"];     // 雪
      if(code>=95)                  return ["#3f2b96","#a8c0ff"];     // 雷雨
      return ["#90b7d6","#dbe6f1"];                                   // 既定
    }
    function applyThemeByCode(code){
      var t=themeFromCode(code);
      document.documentElement.style.setProperty('--md-bg', t[0]);
      document.documentElement.style.setProperty('--md-bg2', t[1]);
      document.body.style.background = "linear-gradient(180deg,"+t[0]+","+t[1]+")";
      document.getElementById("themeColor").setAttribute("content", t[1]);
    }
    function wxIcon(code){ if(code>=95)return "⛈️"; if(code>=71&&code<=86)return "🌨️"; if(code>=61&&code<=67)return "🌧️"; if(code===0||code===1)return "☀️"; if(code===2)return "🌤️"; if(code===3)return "☁️"; return "🌦️"; }
    function wxText(code){ var map={0:"快晴",1:"晴れ",2:"薄曇り",3:"曇り",45:"霧",48:"霧氷",51:"弱い霧雨",53:"霧雨",55:"強い霧雨",61:"弱い雨",63:"雨",65:"強い雨",71:"弱い雪",73:"雪",75:"大雪",95:"雷雨"}; return map[code]||"—"; }
    function renderWx(obj){
      var icon=$("#wxIcon"), temp=$("#wxTemp"), line1=$("#wxLine1"), line2=$("#wxLine2");
      if(!obj){ icon.textContent="⚠️"; temp.textContent="--°C"; line1.textContent="状況：取得失敗　降水確率：—"; line2.textContent="湿度：—　気圧：—"; applyThemeByCode(null); return; }
      icon.textContent=wxIcon(obj.code);
      temp.textContent=Math.round(obj.temp)+"°C";
      line1.textContent="状況："+wxText(obj.code)+"　降水確率："+(obj.pprob!=null?Math.round(obj.pprob)+"%":"—");
      line2.text内容="湿度："+(obj.humidity!=null?Math.round(obj.humidity)+"%":"—")+"　気圧："+(obj.pressure!=null?Math.round(obj.pressure)+"hPa":"—")+" ["+obj.trend+"]";
      applyThemeByCode(obj.code);
    }
    function fetchWx(lat,lon){
      var url="https://api.open-meteo.com/v1/forecast?latitude="+lat+"&longitude="+lon+"&current_weather=true&hourly=pressure_msl,relative_humidity_2m,precipitation_probability&timezone=Asia%2FTokyo";
      fetch(url).then(r=>r.json()).then(data=>{
        var c=data.current_weather||{};
        var times=(data.hourly&&data.hourly.time)||[];
        var pArr=(data.hourly&&data.hourly.pressure_msl)||[];
        var hArr=(data.hourly&&data.hourly.relative_humidity_2m)||[];
        var prArr=(data.hourly&&data.hourly.precipitation_probability)||[];
        var idx=(c.time&&times.length)?nearestIndex(times,c.time):-1;
        var p=(idx>-1&&pArr.length)?pArr[idx]:null;
        var h=(idx>-1&&hArr.length)?hArr[idx]:null;
        var pr=(idx>-1&&prArr.length)?prArr[idx]:null;
        var trend=(idx>-1)?pressureTrend(pArr,idx):"安定";
        state.wx={temp:c.temperature, code:c.weathercode, pressure:p, humidity:h, pprob:pr, trend:trend};
        renderWx(state.wx);
      }).catch(()=>renderWx(null));
    }
    function autoWx(){
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(
          pos=>fetchWx(pos.coords.latitude,pos.coords.longitude),
          ()=>fetchWx(TOKYO.lat,TOKYO.lon),
          {enableHighAccuracy:true,timeout:6000,maximumAge:600000}
        );
      }else{ fetchWx(TOKYO.lat,TOKYO.lon); }
    }
    $("#useGeo").addEventListener("click", autoWx);
    autoWx();

    renderHistory();
  });
})();
</script>
</body>
</html>
