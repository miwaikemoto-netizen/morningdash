<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gardening Dash｜9〜12月版（浜松）</title>
<style>
  /* ===== 月ごとのテーマ色 ===== */
  body.theme-auto[data-month="9"] {
    --bg1:#f6f9f2; --bg2:#e9f0df;
    --card:#ffffff; --border:#d4dec6;
    --fg:#0f172a; --muted:#5b6b86;
    --accent:#eab308;
  }
  body.theme-auto[data-month="10"] {
    --bg1:#fff7ed; --bg2:#ffe4c7;
    --card:#ffffff; --border:#fcd7b3;
    --fg:#3f2010; --muted:#885f4d;
    --accent:#fb923c;
  }
  body.theme-auto[data-month="11"] {
    --bg1:#f9f7fb; --bg2:#efe9f4;
    --card:#ffffff; --border:#dbc8e7;
    --fg:#2a132f; --muted:#7a637f;
    --accent:#c084fc;
  }
  body.theme-auto[data-month="12"] {
    --bg1:#f3f7fb; --bg2:#e4eff9;
    --card:#ffffff; --border:#c6dbed;
    --fg:#0f172a; --muted:#496078;
    --accent:#3b82f6;
  }

  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--fg);
       font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial}
  .wrap{max-width:960px;margin:0 auto;padding:16px 20px 48px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin:8px 0 16px}
  h1{font-size:20px;margin:0}
  select, input, textarea, button{
    background:#fff;color:var(--fg);border:1px solid var(--border);border-radius:10px;
    padding:10px 12px;font-size:14px;
  }
  section{background:var(--card);border:1px solid var(--border);border-radius:14px;
          box-shadow:0 6px 16px rgba(0,0,0,.1);padding:14px 14px;margin:14px 0}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{cursor:pointer}
  .btn.primary{background:var(--accent); border-color:transparent; color:#fff; font-weight:600}
  .btn.ghost{background:transparent;border:1px solid var(--border)}
  ul{list-style:none;margin:0;padding:0}
  li{display:flex;gap:10px;align-items:flex-start;margin:8px 0}
  input[type=checkbox]{width:18px;height:18px;margin-top:2px;accent-color:var(--accent)}
  .line-through{text-decoration:line-through;color:var(--muted)}
  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  th,td{padding:8px 10px;background:#fff;border:1px solid var(--border)}
  th{font-weight:600;color:var(--fg)}
  td a{color:var(--accent);text-decoration:underline}
  .hint{color:var(--muted);font-size:12px;margin-top:6px}
</style>
</head>
<body class="theme-auto" data-month="9">
  <div class="wrap">
    <header>
      <h1>Gardening Dash｜2025 秋冬（浜松）</h1>
      <div class="controls">
        <label>月:
          <select id="monthSel">
            <option value="9">9月</option>
            <option value="10">10月</option>
            <option value="11">11月</option>
            <option value="12">12月</option>
          </select>
        </label>
      </div>
    </header>

    <section id="tasksSec">
      <h2 style="margin:0 0 8px;font-size:18px">今月のチェックリスト</h2>
      <ul id="taskList"></ul>
      <div class="controls" style="margin-top:6px">
        <button class="btn primary" id="addTaskBtn">タスク追加</button>
        <button class="btn ghost" id="resetChecksBtn">全チェック解除</button>
        <button class="btn ghost" id="restoreTplBtn">テンプレに戻す</button>
      </div>
      <div class="hint">チェックや追加は自動保存（localStorage）。</div>
    </section>

    <section id="logSec">
      <h2 style="margin:0 0 8px;font-size:18px">日々の記録</h2>
      <div class="row">
        <label style="flex:1 1 200px">日付<br><input type="datetime-local" id="f_date"></label>
        <label style="flex:1 1 200px">天気・気温<br><input type="text" id="f_weather"></label>
      </div>
      <div class="row" style="margin-top:6px">
        <label style="flex:1 1 240px">作業内容<br><textarea id="f_work" rows="2"></textarea></label>
        <label style="flex:1 1 240px">気づき<br><textarea id="f_memo" rows="2"></textarea></label>
      </div>
      <div class="row" style="margin-top:6px">
        <label style="flex:1 1 180px">対象植物No.<br><input type="text" id="f_plant"></label>
        <label style="flex:1 1 320px">写真リンク<br><input type="url" id="f_photo"></label>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn primary" id="addLogBtn">追加</button>
        <button class="btn ghost" id="exportBtn">CSV書き出し</button>
      </div>

      <div style="overflow:auto;margin-top:10px">
        <table id="logTable">
          <thead>
            <tr>
              <th>日付</th>
              <th>天気・気温</th>
              <th>作業内容</th>
              <th>気づき</th>
              <th>対象植物No.</th>
              <th>写真リンク</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </div>

<script>
const YEAR = new Date().getFullYear();
const TASK_KEY = (m)=>`gd_tasks_${YEAR}_${m}`;
const LOG_KEY = ()=>`gd_logs_${YEAR}`;
const TEMPLATE = {
  9:["バラ 夏剪定／液肥開始","バラ 消毒（剪定後）","温州みかん 液肥","宿根草 植付け・株分け","秋まき一年草 直播"],
  10:["球根 植付け（チューリップ等）","寄せ植え実施","バラ 秋花鑑賞→花がら切り","液肥 継続（下旬終了）","冬野菜 苗定植"],
  11:["落葉樹 植付け（ハナミズキ等）","バラ リセット（病葉整理＋殺菌）","宿根草 切戻し＆マルチ","球根 遅植え分対応"],
  12:["庭木 定植ベスト","温州みかん 収穫","バラ 落葉処理→石灰硫黄合剤","寒肥準備","鉢物 防寒"]
};

const monthSel=document.getElementById('monthSel');
const taskList=document.getElementById('taskList');

// === 月→テーマ連動＆初期化 ===
function applyTheme(){
  document.body.dataset.month = monthSel.value;
}

(function initMonth(){
  const now = new Date().getMonth() + 1;
  const saved = localStorage.getItem('gd_month');
  if (saved) {
    monthSel.value = saved;
  } else {
    monthSel.value = (now >= 9 && now <= 12) ? String(now) : '9';
  }
  applyTheme();
  renderTasks();
})();

monthSel.addEventListener('change', () => {
  document.body.dataset.month = monthSel.value;
  localStorage.setItem('gd_month', monthSel.value);
  renderTasks();
  applyTheme();
});

function loadTasks(m){const raw=localStorage.getItem(TASK_KEY(m));if(raw){try{return JSON.parse(raw);}catch{}}return (TEMPLATE[m]||[]).map(l=>({label:l,done:false}));}
function saveTasks(m,items){localStorage.setItem(TASK_KEY(m),JSON.stringify(items));}
function renderTasks(){const m=parseInt(monthSel.value,10);const items=loadTasks(m);taskList.innerHTML="";items.forEach((t,i)=>{const li=document.createElement('li');const cb=document.createElement('input');cb.type='checkbox';cb.checked=!!t.done;cb.onchange=()=>{const list=loadTasks(m);list[i].done=cb.checked;saveTasks(m,list);label.className=cb.checked?'line-through':''};const label=document.createElement('span');label.textContent=t.label;label.className=t.done?'line-through':'';li.appendChild(cb);li.appendChild(label);taskList.appendChild(li);});}

// logs
const f_date=document.getElementById('f_date'),f_weather=document.getElementById('f_weather'),f_work=document.getElementById('f_work'),f_memo=document.getElementById('f_memo'),f_plant=document.getElementById('f_plant'),f_photo=document.getElementById('f_photo');
const addLogBtn=document.getElementById('addLogBtn'),exportBtn=document.getElementById('exportBtn'),logTableBody=document.querySelector('#logTable tbody');
function pad(n){return String(n).padStart(2,'0');}
f_date.value=(function(){const d=new Date();return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;})();
function loadLogs(){const raw=localStorage.getItem(LOG_KEY());if(!raw)return[];try{return JSON.parse(raw);}catch{return[];}}
function saveLogs(list){localStorage.setItem(LOG_KEY(),JSON.stringify(list));}
let logs=loadLogs();
function renderLogs(){logTableBody.innerHTML="";logs.forEach((l,idx)=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${l.dateDisplay}</td><td>${l.weather||""}</td><td>${l.work||""}</td><td>${l.memo||""}</td><td>${l.plant||""}</td><td>${l.photo?`<a href='${l.photo}' target='_blank'>開く</a>`:""}</td><td><button data-del='${idx}'>削除</button></td>`;logTableBody.appendChild(tr);});document.querySelectorAll('button[data-del]').forEach(btn=>{btn.onclick=()=>{logs.splice(parseInt(btn.dataset.del),1);saveLogs(logs);renderLogs();};});}
renderLogs();
addLogBtn.onclick=()=>{const d=new Date(f_date.value);if(isNaN(d.getTime())){alert('日付を入れてね');return;}const disp=`${d.getFullYear()}/${pad(d.getMonth()+1)}/${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;const entry={dateDisplay:disp,weather:f_weather.value.trim(),work:f_work.value.trim(),memo:f_memo.value.trim(),plant:f_plant.value.trim(),photo:f_photo.value.trim()};logs.unshift(entry);saveLogs(logs);renderLogs();f_work.value=f_memo.value=f_plant.value=f_photo.value="";};
function escapeCSV(s){if(!s)return"";s=String(s);return (s.includes(',')||s.includes('"')||s.includes('\n'))?`"${s.replace(/"/g,'""')}"`:s;}
exportBtn.onclick=()=>{const header=["日付","天気・気温","作業内容","気づき","対象植物No.","写真リンク"];const rows=logs.slice().reverse().map(l=>[l.dateDisplay,l.weather,l.work,l.memo,l.plant,l.photo]);const lines=[header.join(",")].concat(rows.map(r=>r.map(escapeCSV).join(","))).join("\n");const blob=new Blob([lines],{type:"text/csv;charset=utf-8;"});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`gardening_log_${YEAR}.csv`;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);};
</script>
</body>
</html>
