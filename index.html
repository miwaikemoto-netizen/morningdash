<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Morning Dash</title>
<meta name="theme-color" content="#d6f0ff" id="themeColor">
<style>
:root{
  --md-bg:#88c8ff;
  --md-bg2:#d6f0ff;
  --fg:#0e1726; --muted:#354357;
  --card:#ffffffd9; --border:#0000001a;
  --accent:#2563eb; --accent-press:#1d4ed8;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;height:100%;color:var(--fg);transition:background .35s ease}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
  background:linear-gradient(
    180deg,
    var(--md-bg) 0%,
    var(--md-bg2) 50%,
    var(--md-bg2) 50%,
    var(--md-bg) 100%
  );
}
.container{max-width:900px;margin:0 auto;padding:16px 16px 92px}
h1{margin:4px 0 4px;font-size:28px;font-weight:800;display:flex;gap:10px;align-items:baseline;flex-wrap:wrap}
h2{margin:0 0 10px;font-size:18px}
.card{background:var(--card);backdrop-filter:saturate(1.1) blur(2px);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 30px #00000030;padding:16px;margin:12px 0}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.row.nw{flex-wrap:nowrap}
.btn{appearance:none;border:1px solid var(--border);border-radius:14px;padding:8px 12px;background:#ffffffb3;cursor:pointer;color:#0e1726;text-decoration:none;font-size:14px}
.btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
.btn.primary:active{background:var(--accent-press)}
.btn.small{padding:6px 10px;font-size:13px}
.input,select,textarea{border:1px solid var(--border);border-radius:12px;padding:10px 12px;background:#ffffffcc;color:#0e1726;font-size:16px}
select[multiple]{min-height:132px}
textarea{width:100%;min-height:96px;resize:vertical}
.small{font-size:13px;color:#475569}
.labelBig{font-size:15px;font-weight:700;margin-right:6px}
.header{display:flex;justify-content:space-between;align-items:flex-end;gap:10px;flex-wrap:wrap;margin-bottom:6px}
.bigdate{display:flex;align-items:baseline;gap:8px}
.bigdate .date{font-weight:800;font-size:30px}
.bigdate .wday{font-weight:700}
#year{font-size:16px;font-weight:400;color:#64748b}
.historyItem{padding:10px;border:1px dashed var(--border);border-radius:12px;margin-top:8px;background:#fff}
label.checkbox{display:flex;align-items:center;gap:10px;cursor:pointer;font-size:16px}
label.checkbox input{transform:scale(1.2)}
.weatherTitle{display:flex;justify-content:space-between;align-items:center;gap:8px}
#wxMain{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.wxIcon{font-size:30px}
#wxTemp{font-size:22px;font-weight:800}
.wxLine{font-size:15px;font-weight:700;margin-top:6px}
#navRow{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.input.compact{width:120px}
.input.compact.short{width:86px}
@media (max-width:420px){.input.compact{width:110px}.input.compact.short{width:78px}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <h1>â˜€ï¸ Morning Dash <span id="year">2025</span></h1>
      <div class="bigdate">
        <span class="date" id="ymd">--/--</span>
        <span class="wday" id="wday">---</span>
      </div>
    </div>
    <div id="navRow">
      <a href="./EveningDash.html" class="btn">ğŸŒ™ å¤œã®è¨˜éŒ²ã¸</a>
      <a id="openCal" href="./Calendar.html" class="btn">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a>
    </div>
  </div>

  <!-- â‘  å¤©æ°— -->
  <section class="card" id="secWeather">
    <div class="weatherTitle">
      <h2>â‘  å¤©æ°—ï¼ˆè‡ªå‹•å–å¾—ï¼‰</h2>
      <button id="useGeo" class="btn small">å†å–å¾—</button>
    </div>
    <div id="wxMain"><div id="wxIcon" class="wxIcon">â³</div><div id="wxTemp">--Â°C</div></div>
    <div id="wxLine1" class="wxLine">çŠ¶æ³ï¼šâ€”ã€€é™æ°´ç¢ºç‡ï¼šâ€”</div>
    <div id="wxLine2" class="wxLine">æ¹¿åº¦ï¼šâ€”ã€€æ°—åœ§ï¼šâ€”</div>
  </section>

  <!-- â‘¡ æ—¥è¨˜ãƒ»è¨˜éŒ² -->
  <section class="card" id="secDiary">
    <h2>â‘¡ æ—¥è¨˜ãƒ»è¨˜éŒ²</h2>
    <div class="row">
      <label for="moodSel" class="labelBig">æ„Ÿæƒ…</label>
      <select id="moodSel" class="input"><option value="">ï¼ˆæœªé¸æŠï¼‰</option><option>æœ€é«˜</option><option>è‰¯ã„</option><option>æ™®é€š</option><option>ã„ã¾ã„ã¡</option><option>ã—ã‚“ã©ã„</option></select>
    </div>

    <div class="row">
      <label for="condSel" class="labelBig">ä½“èª¿ï¼ˆè¤‡æ•°å¯ï¼‰</label>
      <select id="condSel" class="input" multiple><option>é¦–ãƒ»è‚©ã“ã‚Š</option><option>é ­ç—›</option><option>è…¹ç—›/ãŠè…¹ã®å¼µã‚Š</option><option>è…°ã®å¼µã‚Š/è…°ç—›</option><option>è‡ªå¾‹ç¥çµŒã®ä¹±ã‚Œ</option><option>èƒƒè…¸å¼±ã‚</option><option>ã‚€ãã¿</option><option>ç›®ã®ç–²ã‚Œ/ãƒ‰ãƒ©ã‚¤ã‚¢ã‚¤</option><option>ç¡çœ ã®è³ªä½ä¸‹</option><option>å†·ãˆ</option><option>å–‰ã®ç—›ã¿</option><option>é¼»æ°´/é¼»ã¥ã¾ã‚Š</option><option>è‚Œè’ã‚Œ/ã‹ã‚†ã¿</option><option>èŠ±ç²‰/ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</option><option>ã ã‚‹ã•/å€¦æ€ æ„Ÿ</option><option>ã‚¤ãƒ©ã‚¤ãƒ©/ä¸å®‰</option><option>ãƒ¢ãƒãƒ™ä½ä¸‹</option><option>PMS</option><option>ç”Ÿç†</option></select>
    </div>

    <div class="row nw">
      <label class="labelBig" for="sleepH">ç¡çœ </label>
      <input id="sleepH" class="input compact short" type="number" min="0"><span>æ™‚é–“</span>
      <input id="sleepM" class="input compact short" type="number" min="0" max="59"><span>åˆ†</span>
      <span id="sleepLabel" class="small"></span>
    </div>

    <div class="row">
      <label class="labelBig" for="weight">ä½“é‡</label>
      <input id="weight" class="input compact" type="number" step="0.1"><span>kg</span>
    </div>
    <div class="row">
      <label class="labelBig" for="bodyFat">ä½“è„‚è‚ª</label>
      <input id="bodyFat" class="input compact" type="number" step="0.1"><span>%</span>
      <span id="wbLabel" class="small"></span>
    </div>

    <div style="margin-top:12px">
      <label for="freeMemo">ğŸ““ è‡ªç”±ãƒ¡ãƒ¢</label><textarea id="freeMemo"></textarea>
    </div>
  </section>

  <!-- â‘¢ ç”Ÿæ´»ç¿’æ…£ãƒã‚§ãƒƒã‚¯ -->
  <section class="card" id="secHabits"><h2>â‘¢ ç”Ÿæ´»ç¿’æ…£ãƒã‚§ãƒƒã‚¯</h2>
    <div class="row">
      <label class="checkbox"><input type="checkbox" id="h_curtain"> ã‚«ãƒ¼ãƒ†ãƒ³ã‚’é–‹ã‘ã‚‹</label>
      <label class="checkbox"><input type="checkbox" id="h_bed"> å¸ƒå›£ã‚’ç›´ã™</label>
      <label class="checkbox"><input type="checkbox" id="h_change"> ç€æ›¿ãˆã‚’ã™ã‚‹</label>
      <label class="checkbox"><input type="checkbox" id="h_teeth"> æ­¯ç£¨ã</label>
      <label class="checkbox"><input type="checkbox" id="h_skin"> ã‚¹ã‚­ãƒ³ã‚±ã‚¢</label>
      <label class="checkbox"><input type="checkbox" id="h_hair"> ãƒ˜ã‚¢ã‚±ã‚¢</label>
    </div>
  </section>

  <section class="card" id="secSave"><div class="row"><button id="saveBtn" class="btn primary">ğŸ’¾ ä¿å­˜</button></div></section>

  <section class="card">
    <div class="row" style="justify-content:space-between"><h2>å±¥æ­´</h2><button id="reloadBtn" class="btn">å†èª­è¾¼</button></div>
    <div id="history"></div>
  </section>
</div>

<script>
(function(){
  function z2(n){n=Number(n)||0;return(n<10?"0":"")+n;}
  function $(s){return document.querySelector(s);}

  document.addEventListener("DOMContentLoaded",function(){
    // æ—¥ä»˜ãƒ»ãƒªãƒ³ã‚¯
    var d=new Date();
    $("#year").textContent=d.getFullYear();
    $("#ymd").textContent=z2(d.getMonth()+1)+"/"+z2(d.getDate());
    $("#wday").textContent=["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][d.getDay()]+"æ›œæ—¥";
    $("#openCal").href="./Calendar.html?date="+d.toISOString().slice(0,10);

    // ---- ã“ã“ã‹ã‚‰ï¼šã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå–ã‚Šè¾¼ã¿ + è¡¨è¨˜ ----
    function updateLabels(){
      var h=Number($("#sleepH").value)||0, m=Number($("#sleepM").value)||0;
      $("#sleepLabel").textContent = (h||m) ? ("ã€€â†’ "+h+"æ™‚é–“"+m+"åˆ†") : "";
      var w=$("#weight").value, bf=$("#bodyFat").value;
      var bfTxt = (bf!=="" && !isNaN(bf)) ? (Number(bf).toFixed(1)+"%") : "";
      var wTxt  = (w!==""  && !isNaN(w))  ? (Number(w)+"kg") : "";
      $("#wbLabel").textContent = (wTxt||bfTxt) ? ("ã€€â†’ "+[wTxt,bfTxt].filter(Boolean).join(" / ")) : "";
    }
    // ã‚¯ã‚¨ãƒªå–ã‚Šè¾¼ã¿ï¼ˆæœ€å°ï¼‰
    try{
      var usp = new URLSearchParams(location.search);
      if(usp.has("sleepMin")){
        var sm = Math.max(0, Math.floor(Number(usp.get("sleepMin"))||0));
        $("#sleepH").value = Math.floor(sm/60);
        $("#sleepM").value = sm%60;
      }
      if(usp.has("weight")){
        $("#weight").value = String(usp.get("weight")).replace(",",".");
      }
      if(usp.has("bodyFat")){
        $("#bodyFat").value = String(usp.get("bodyFat")).replace(",",".");
      }
      updateLabels();
    }catch(e){}
    // å…¥åŠ›å¤‰æ›´ã§ãƒ©ãƒ™ãƒ«æ›´æ–°
    ["sleepH","sleepM","weight","bodyFat"].forEach(id=>{
      var el=$("#"+id); if(el) el.addEventListener("input",updateLabels);
    });
    // ---- ã“ã“ã¾ã§ï¼šã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå–ã‚Šè¾¼ã¿ + è¡¨è¨˜ ----

    // ä»¥é™ã¯æ—¢å­˜ã®å±¥æ­´ãƒ»å¤©æ°—ï¼ˆãã®ã¾ã¾ï¼‰
    var KEY="morning_logs_index_gradient";
    function loadAll(){try{var v=localStorage.getItem(KEY);return v?JSON.parse(v):[];}catch(e){return[];}}
    function saveAll(arr){try{localStorage.setItem(KEY,JSON.stringify(arr));}catch(e){}}
    function toKey(dt){return dt.toLocaleDateString("ja-JP",{timeZone:"Asia/Tokyo"});}
    function upsert(payload){var list=loadAll(),i=list.findIndex(x=>x.date===payload.date);if(i>-1)list[i]=payload;else list.unshift(payload);list.sort((a,b)=>a.date<b.date?1:-1);saveAll(list);}
    function renderHistory(){var root=$("#history");root.innerHTML="";var logs=loadAll();if(!logs.length){root.innerHTML='<div class="small">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>';return;}logs.forEach(l=>{var press=l.wx&&l.wx.pressure!=null?Math.round(l.wx.pressure)+"hPa":"â€”";var hum=l.wx&&l.wx.humidity!=null?Math.round(l.wx.humidity)+"%":"â€”";var pprob=l.wx&&l.wx.pprob!=null?Math.round(l.wx.pprob)+"%":"â€”";var wtemp=l.wx&&l.wx.temp!=null?Math.round(l.wx.temp)+"Â°C":"â€”";var trend=(l.wx&&l.wx.trend)||"â€”";var box=document.createElement("div");box.className="historyItem";box.innerHTML="<b>"+l.date+"</b>ã€€å¤©æ°—ï¼š"+wtemp+"ãƒ»é™æ°´ç¢ºç‡ï¼š"+pprob+"ãƒ»æ¹¿åº¦ï¼š"+hum+"ãƒ»æ°—åœ§ï¼š"+press+" ["+trend+"]";root.appendChild(box);});}
    $("#reloadBtn").addEventListener("click",renderHistory);
    $("#saveBtn").addEventListener("click",function(){upsert({date:toKey(new Date()),wx:state.wx,ts:Date.now()});renderHistory();alert("ä¿å­˜ã—ã¾ã—ãŸ");});
    var state={wx:null};
    var TOKYO={lat:35.681236,lon:139.767125};
    function nearestIndex(times,targetISO){var best=-1,bestDiff=1e18,t0=new Date(targetISO).getTime();for(var i=0;i<times.length;i++){var dt=new Date(times[i]).getTime();var d=Math.abs(dt-t0);if(d<bestDiff){best=i;bestDiff=d;}}return best;}
    function pressureTrend(arr,idx){if(!(arr&&arr.length)||idx<1)return"å®‰å®š";var diff=arr[idx]-arr[idx-1];if(diff>1.5)return"ä¸Šæ˜‡";if(diff<-1.5)return"ä¸‹é™";return"å®‰å®š";}
    function themeFromCode(code){if(code===0||code===1)return["#88c8ff","#d6f0ff"];if(code===2)return["#a6c1de","#eaf1fb"];if(code===3||code===45||code===48)return["#8ea1b5","#d4dbe3"];if((code>=51&&code<=55)||(code>=61&&code<=67))return["#5f7f92","#b8d2db"];if(code>=71&&code<=86)return["#bfe2ff","#eef7ff"];if(code>=95)return["#3f2b96","#a8c0ff"];return["#90b7d6","#dbe6f1"];}
    function applyThemeByCode(code){var t=themeFromCode(code);document.documentElement.style.setProperty('--md-bg',t[0]);document.documentElement.style.setProperty('--md-bg2',t[1]);document.body.style.background="linear-gradient(180deg,"+t[0]+" 0%,"+t[1]+" 50%,"+t[1]+" 50%,"+t[0]+" 100%)";document.getElementById("themeColor").setAttribute("content",t[1]);}
    function wxIcon(code){if(code>=95)return"â›ˆï¸";if(code>=71&&code<=86)return"ğŸŒ¨ï¸";if(code>=61&&code<=67)return"ğŸŒ§ï¸";if(code===0||code===1)return"â˜€ï¸";if(code===2)return"ğŸŒ¤ï¸";if(code===3)return"â˜ï¸";return"ğŸŒ¦ï¸";}
    function wxText(code){var map={0:"å¿«æ™´",1:"æ™´ã‚Œ",2:"è–„æ›‡ã‚Š",3:"æ›‡ã‚Š",45:"éœ§",48:"éœ§æ°·",51:"å¼±ã„éœ§é›¨",53:"éœ§é›¨",55:"å¼·ã„éœ§é›¨",61:"å¼±ã„é›¨",63:"é›¨",65:"å¼·ã„é›¨",71:"å¼±ã„é›ª",73:"é›ª",75:"å¤§é›ª",95:"é›·é›¨"};return map[code]||"â€”";}
    function renderWx(obj){var icon=$("#wxIcon"),temp=$("#wxTemp"),line1=$("#wxLine1"),line2=$("#wxLine2");if(!obj){icon.textContent="âš ï¸";temp.textContent="--Â°C";line1.textContent="çŠ¶æ³ï¼šå–å¾—å¤±æ•—ã€€é™æ°´ç¢ºç‡ï¼šâ€”";line2.textContent="æ¹¿åº¦ï¼šâ€”ã€€æ°—åœ§ï¼šâ€”";applyThemeByCode(null);return;}icon.textContent=wxIcon(obj.code);temp.textContent=Math.round(obj.temp)+"Â°C";line1.textContent="çŠ¶æ³ï¼š"+wxText(obj.code)+"ã€€é™æ°´ç¢ºç‡ï¼š"+(obj.pprob!=null?Math.round(obj.pprob)+"%":"â€”");line2.textContent="æ¹¿åº¦ï¼š"+(obj.humidity!=null?Math.round(obj.humidity)+"%":"â€”")+"ã€€æ°—åœ§ï¼š"+(obj.pressure!=null?Math.round(obj.pressure)+"hPa":"â€”")+" ["+obj.trend+"]";applyThemeByCode(obj.code);}
    function fetchWx(lat,lon){var url="https://api.open-meteo.com/v1/forecast?latitude="+lat+"&longitude="+lon+"&current_weather=true&hourly=pressure_msl,relative_humidity_2m,precipitation_probability&timezone=Asia%2FTokyo";fetch(url).then(r=>r.json()).then(data=>{var c=data.current_weather||{};var times=(data.hourly&&data.hourly.time)||[];var pArr=(data.hourly&&data.hourly.pressure_msl)||[];var hArr=(data.hourly&&data.hourly.relative_humidity_2m)||[];var prArr=(data.hourly&&data.hourly.precipitation_probability)||[];var idx=(c.time&&times.length)?nearestIndex(times,c.time):-1;var p=(idx>-1&&pArr.length)?pArr[idx]:null;var h=(idx>-1&&hArr.length)?hArr[idx]:null;var pr=(idx>-1&&prArr.length)?prArr[idx]:null;var trend=(idx>-1)?pressureTrend(pArr,idx):"å®‰å®š";state.wx={temp:c.temperature,code:c.weathercode,pressure:p,humidity:h,pprob:pr,trend:trend};renderWx(state.wx);}).catch(()=>renderWx(null));}
    function autoWx(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(pos=>fetchWx(pos.coords.latitude,pos.coords.longitude),()=>fetchWx(TOKYO.lat,TOKYO.lon),{enableHighAccuracy:true,timeout:6000,maximumAge:600000});}else{fetchWx(TOKYO.lat,TOKYO.lon);}}
    $("#useGeo").addEventListener("click",autoWx);autoWx();renderHistory();
  });
      // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿ï¼ˆã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆé€£æºç”¨ï¼‰
    const url = new URL(window.location.href);
    const qp = k => url.searchParams.get(k);

    // ç¡çœ ï¼ˆåˆ†å˜ä½ã‚’ æ™‚é–“+åˆ† ã«å¤‰æ›ï¼‰
    if (qp("sleepMin") != null) {
      const sm = parseInt(qp("sleepMin"), 10) || 0;
      const h = Math.floor(sm / 60);
      const m = sm % 60;
      document.getElementById("sleepH").value = h;
      document.getElementById("sleepM").value = m;
    }

    // ä½“é‡
    if (qp("weight") != null) {
      document.getElementById("weight").value = parseFloat(qp("weight")) || "";
    }

    // ä½“è„‚è‚ªç‡
    if (qp("bodyFat") != null) {
      document.getElementById("bodyFat").value = parseFloat(qp("bodyFat")) || "";
    }
})();
</script>
</body>
</html>
